% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/A00-surveff.R
\name{surveff}
\alias{surveff}
\title{Survival Effect Estimation with Propensity Score Weighting}
\usage{
surveff(
  data,
  ps_formula,
  censoring_formula,
  eval_times = NULL,
  estimand = "ATE",
  att_group = NULL,
  trim = NULL,
  delta = NULL,
  alpha = NULL,
  contrast_matrix = NULL,
  censoring_method = "weibull",
  variance_method = NULL,
  B = 100,
  parallel = FALSE,
  mc.cores = 2,
  seed = NULL,
  censoring_control = NULL,
  ties = "efron",
  ps_control = list(),
  boot_level = "full"
)
}
\arguments{
\item{data}{Data frame containing treatment, outcome, and covariates.}

\item{ps_formula}{Formula for propensity score model: \code{treatment ~ covariates}.}

\item{censoring_formula}{Formula for censoring model: \code{Surv(time, event) ~ covariates}.
Event should be coded as 1=event, 0=censored. Use \code{I(1-event)} if reversed.}

\item{eval_times}{Numeric vector of time points for evaluation. If NULL (default),
uses all unique event times.}

\item{estimand}{Target estimand: "ATE" (average treatment effect), "ATT" (average
treatment effect on the treated), or "overlap" (overlap weighting). Default "ATE".}

\item{att_group}{Target group for ATT. Required if \code{estimand = "ATT"}.}

\item{trim}{Trimming method: "symmetric" or "asymmetric". Default NULL (no trimming).}

\item{delta}{Threshold for symmetric trimming (e.g., 0.1). Required if \code{trim = "symmetric"}.}

\item{alpha}{Percentile for asymmetric trimming (e.g., 0.05). Required if \code{trim = "asymmetric"}.}

\item{contrast_matrix}{Optional matrix for treatment differences in multiple group settings.
Each row defines one contrast with exactly two non-zero elements: -1 and 1.
Column names must match treatment levels. For binary treatment, always estimates
second level minus first level (S1 - S0), ignoring this parameter.}

\item{censoring_method}{Method for censoring score estimation: "weibull" or "cox".
Default "weibull".}

\item{variance_method}{Variance estimation method: "analytical" (binary treatment with
Weibull censoring only) or "bootstrap". Default "analytical" for binary Weibull,
"bootstrap" otherwise. Cox censoring always uses bootstrap.}

\item{B}{Number of bootstrap iterations. Default 100. Used only if \code{variance_method = "bootstrap"}.}

\item{parallel}{Logical. Use parallel bootstrap computation? Default FALSE.}

\item{mc.cores}{Number of cores for parallel bootstrap. Default 2.}

\item{seed}{Random seed for bootstrap reproducibility. Default NULL.}

\item{censoring_control}{Control parameters passed to censoring model fitting function.
For Weibull: passed to \code{survreg()}, default \code{list(maxiter = 350)}.
For Cox: passed to \code{coxph()}, default \code{list()}.}

\item{ties}{Tie handling method for Cox models. Default "efron". Ignored for Weibull.}

\item{ps_control}{Control parameters for propensity score model. Default \code{list()}.}

\item{boot_level}{Bootstrap sampling level: "full" (default) or "strata".
"full" resamples from entire dataset (observational studies). "strata"
resamples within treatment groups preserving group sizes (RCTs). Only
used if variance_method = "bootstrap".}
}
\value{
List containing:
  \item{survival_estimates}{Matrix [time x J] of survival function estimates for each group.}
  \item{survival_se}{Matrix [time x J] of standard errors for survival functions.}
  \item{difference_estimates}{Matrix [time x K] of treatment effect estimates.
    For binary treatment: single column with S1-S0. For multiple groups: contrasts
    from \code{contrast_matrix}, or NULL if not provided.}
  \item{difference_se}{Matrix [time x K] of standard errors for treatment effects.}
  \item{eval_times}{Time points evaluated.}
  \item{treatment_levels}{Sorted unique treatment values.}
  \item{n_levels}{Number of treatment groups.}
  \item{n}{Sample size (complete cases after data validation).}
  \item{included}{Logical vector [n] indicating inclusion in analysis. TRUE = included,
    FALSE = excluded due to trimming.}
  \item{estimand}{Estimand used.}
  \item{censoring_method}{Censoring method used.}
  \item{variance_method}{Variance method used.}
  \item{contrast_matrix}{Contrast matrix used (NULL if not applicable).}
  \item{ps_model}{Fitted propensity score model (glm or multinom object).}
  \item{censoring_models}{Named list of fitted censoring models by treatment group.}
  \item{weights}{Numeric vector [n] of final weights (0 for trimmed observations).}
  \item{trim_summary}{Data frame with trimming summary by treatment group.}
  \item{ess}{Named numeric vector of effective sample size by treatment group.}
  \item{boot_result}{Bootstrap results (NULL if analytical variance used).}
}
\description{
Main user interface for estimating counterfactual survival functions and
treatment effects using propensity score weighting and inverse probability
of censoring weighting. Supports binary and multiple treatment groups with
various weighting schemes (ATE, ATT, overlap) and optional trimming.
}
\details{
**Variance Estimation:**
- Analytical: Binary treatment with Weibull censoring only (M-estimation).
- Bootstrap: All settings (resamples entire pipeline).
- Cox: Always uses bootstrap.

**Treatment Effects:**
- Binary: S1 - S0 (second level minus first).
- Multiple groups: Requires \code{contrast_matrix} for pairwise comparisons.
}
\examples{
\dontrun{
# Binary treatment with overlap weights
result <- surveff(
  data = mydata,
  ps_formula = trt ~ age + sex,
  censoring_formula = Surv(time, event) ~ age,
  estimand = "overlap",
  censoring_method = "weibull"
)

# Multiple groups with ATE and symmetric trimming
result <- surveff(
  data = mydata,
  ps_formula = group ~ age + sex + comorbidity,
  censoring_formula = Surv(time, event) ~ age + comorbidity,
  estimand = "ATE",
  trim = "symmetric",
  delta = 0.1,
  censoring_method = "cox",
  variance_method = "bootstrap",
  B = 500,
  parallel = TRUE,
  mc.cores = 4
)
}

}
